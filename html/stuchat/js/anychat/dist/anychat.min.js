!function(t){t.anychat||(t.anychat={});t.anychat.chatObjEventType=new function(){this.OPEN_CHAT_OBJ="openChatObj"}}(window),function(t){t.anychat||(t.anychat={});t.anychat.getUrlParam=new function(){this.getUrlParam=function(t){for(var e=location.search,s=(e=e.substring(1)).split("&"),i=null,n=0;n<s.length;n++){var a=s[n];if(-1!==a.indexOf(t+"=")){i=a.split("=")[1];break}}return i}}}(window),function(t){t.anychat||(t.anychat={});t.anychat.notificationExt=new function(){this.LOGIN_CHAT_SERVER_SUCCESS="loginChatServerSuccess",this.CHAT_USER_ONLINE="chatUserOnline",this.CHAT_USER_OFFLINE="chatUserOffline",this.CHAT_USER_MESSAGE="chatUserMessage",this.CHAT_GROUP_MESSAGE="chatGroupMessage",this.CHAT_KICK="chatKick",this.AGAIN_CONNECT="againConnect",this.GET_CHAT_LIST="getChatList",this.CHAT_TO_USER_MESSAGE="chatToUserMessage"}}(window),function(t){t.anychat||(t.anychat={});var e=t.anychat.notificationExt,s=t.juggle.webSocketEventType,i=t.juggle.Proxy;t.anychat.loginChatProxy=new function(){i.apply(this),this.url=null,this.webSocketClient=null,this.init=function(t){this.webSocketClient=t,this.webSocketClient.addEventListener(s.getMessage("2"),this.onLoginChatServer,this),this.webSocketClient.addEventListener(s.getMessage("3"),this.onUserOnline,this),this.webSocketClient.addEventListener(s.getMessage("4"),this.onUserOffline,this),this.webSocketClient.addEventListener(s.getMessage("6"),this.onUserMessage,this),this.webSocketClient.addEventListener(s.getMessage("7"),this.onGroupMessage,this),this.webSocketClient.addEventListener(s.getMessage("10"),this.onUserKick,this),this.webSocketClient.addEventListener(s.getMessage("11"),this.onAgainConnect,this),this.webSocketClient.addEventListener(s.getMessage("13"),this.onGetMessage,this),this.webSocketClient.addEventListener(s.getMessage("14"),this.onToUserMessage,this)},this.onLoginChatServer=function(t){this.notifyObservers(this.getNotification(e.LOGIN_CHAT_SERVER_SUCCESS,t.mData))},this.onUserOnline=function(t){this.notifyObservers(this.getNotification(e.CHAT_USER_ONLINE,t.mData))},this.onUserOffline=function(t){this.notifyObservers(this.getNotification(e.CHAT_USER_OFFLINE,t.mData))},this.onUserMessage=function(t){this.notifyObservers(this.getNotification(e.CHAT_USER_MESSAGE,t.mData));var s=t.mData;if(null!==s.message&&void 0!==s.message){for(var i=[],n=0;n<s.message.length;n++){var a=s.message[n];i.push(a.chatId)}this.sendUserMessageReceive(i,s.userId)}},this.onGroupMessage=function(t){this.notifyObservers(this.getNotification(e.CHAT_GROUP_MESSAGE,t.mData));var s=t.mData;null!==s.message&&void 0!==s.message&&this.sendGroupMessageReceive(s.message[s.message.length-1].chatId,s.chatGroupId)},this.onUserKick=function(t){this.notifyObservers(this.getNotification(e.CHAT_KICK,t.mData))},this.onAgainConnect=function(t){this.notifyObservers(this.getNotification(e.AGAIN_CONNECT,t.mData))},this.onGetMessage=function(t){this.notifyObservers(this.getNotification(e.GET_CHAT_LIST,t.mData))},this.onToUserMessage=function(t){this.notifyObservers(this.getNotification(e.CHAT_TO_USER_MESSAGE,t.mData))},this.loginChat=function(t){var e={wsOpCode:1,token:t};this.webSocketClient.send(e)},this.sendMessage=function(t,e,s){var i={wsOpCode:5,chatContent:t,toType:e,toTypeId:s};this.webSocketClient.send(i)},this.getMessage=function(t,e,s,i,n){var a={wsOpCode:12,toType:t,toTypeId:e,chatCreateTime:s,currentPage:i,pageSize:n};this.webSocketClient.send(a)},this.sendUserMessageReceive=function(t,e){var s={wsOpCode:8,messageId:t,userId:e};this.webSocketClient.send(s)},this.sendGroupMessageReceive=function(t,e){var s={wsOpCode:9,endChatId:t,chatGroupId:e};this.webSocketClient.send(s)}}}(window),function(t){t.anychat||(t.anychat={});var e=t.anychat.chatObjEventType,s=t.juggle.EventDispatcher;t.anychat.UserObj=function(){this.user=null,this.view=null,this.chatList=[],this.shadow=null,s.apply(this),this.init=function(t){this.user=t,this.createView()},this.createView=function(){var t=document.createElement("li");this.user.isOnline||(t.className="downLine_P");var e;e=null===this.user.userImg||void 0===this.user.userImg?"js/anychat/images/default.png":this.user.userImg,t.innerHTML='<img src="'+e+'" alt=""/><span>'+this.user.userRealName+"</span>",this.view=$(t),this.view.attr("id",this.user.userId),this.shadow=$("<i class='shadow_P'></i>"),this.user.isOnline||this.view.append(this.shadow)},this.onLine=function(){this.view.removeClass("downLine_P"),this.shadow.remove()},this.offLine=function(){this.view.addClass("downLine_P"),this.view.append(this.shadow)},this.addOptListener=function(){this.addClickListener(this,this.onClick)},this.addClickListener=function(t,e){this.view.on("click",function(s){e.call(t,s)})},this.onClick=function(t){$(".windowL_P li").removeClass("on_P"),this.view.addClass("on_P"),this.dispatchEventWith(e.OPEN_CHAT_OBJ)}}}(window),function(t){t.anychat||(t.anychat={});var e=t.anychat.chatObjEventType,s=t.juggle.EventDispatcher;t.anychat.GroupObj=function(){this.group=null,this.view=null,this.chatList=[],s.apply(this),this.init=function(t){this.group=t,this.createView()},this.createView=function(){var t=document.createElement("li");t.className="talkGroup_P",t.innerHTML='<img src="js/anychat/images/groupIcon.png" alt=""/><span class="titleSty2_P">'+this.group.chatGroupName+"</span>",this.view=$(t)},this.addOptListener=function(){this.addClickListener(this,this.onClick)},this.addClickListener=function(t,e){this.view.on("click",function(s){e.call(t,s)})},this.onClick=function(t){$(".windowL_P li").removeClass("on_P"),this.view.addClass("on_P"),this.dispatchEventWith(e.OPEN_CHAT_OBJ)}}}(window),function(t){t.anychat||(t.anychat={});var e=t.anychat.chatObjEventType,s=t.anychat.getUrlParam,i=t.anychat.notificationExt,n=t.anychat.loginChatProxy,a=t.anychat.GroupObj,o=t.anychat.UserObj,h=t.juggle.Mediator,r=t.juggle.WebSocketClient,c=t.juggle.webSocketEventType;t.anychat.TalkMediator=function(){this.webSocketClient=null,this.groupMap=[],this.userMap=[],this.nowToObj=null,this.own=null,this.onlineNum=0,this.userNum=0,this.pageSize=20,this.currentPage=0,this.totalPage=0,this.maxPage=9999,this.nowModule=1,this.token=null,this.initView=function(t){if(this.token=s.getUrlParam("token"),null!==this.token&&void 0!==this.token){this.loginChatServer(),this.addSendChat(this,this.onSendChat),this.addHistory(this,this.onClickHistory),this.addFirstPage(this,this.onFirstPage),this.addPrePage(this,this.onPrePage),this.addNextPage(this,this.onNextPage),this.addLastPage(this,this.onLastPage),this.addReturnChat(this,this.onReturnChat),$(".windowL_P>dd").mCustomScrollbar({theme:"minimal",advanced:{autoExpandHorizontalScroll:!0},scrollbarPosition:"outside"}),$(".talkCon_P").mCustomScrollbar({theme:"minimal",advanced:{autoExpandHorizontalScroll:!0},scrollbarPosition:"outside"}),$(".hisList_P").mCustomScrollbar({theme:"minimal",advanced:{autoExpandHorizontalScroll:!0},scrollbarPosition:"outside"});var e=1;$(".windowL_P .group").on("click","p",function(){1===e?($(this).parent().siblings().find(".slid_P").removeClass("slid_P"),$(this).parent().siblings().find("ul").stop().slideUp(),$(this).parent().find("p").addClass("slid_P").next().slideDown(function(){e=2})):($(this).parent().siblings().find(".slid_P").removeClass("slid_P"),$(this).parent().siblings().find("ul").stop().slideUp(),$(this).parent().find("p").removeClass("slid_P").next().slideUp(function(){e=1}))})}},this.addSendChat=function(t,e){$("#sendChat").on("click",function(s){e.call(t,s)})},this.addHistory=function(t,e){$(".history_P").on("click",function(s){e.call(t,s)})},this.addFirstPage=function(t,e){$("#firstPage").on("click",function(s){e.call(t,s)})},this.addPrePage=function(t,e){$("#prePage").on("click",function(s){e.call(t,s)})},this.addNextPage=function(t,e){$("#nextPage").on("click",function(s){e.call(t,s)})},this.addLastPage=function(t,e){$("#lastPage").on("click",function(s){e.call(t,s)})},this.addReturnChat=function(t,e){$("#returnChat").on("click",function(s){e.call(t,s)})},this.loginChatServer=function(){this.logoutChatServer(),this.webSocketClient=new r(n.url),this.webSocketClient.addEventListener(c.CONNECTED,this.onConnected,this),this.webSocketClient.addEventListener(c.CLOSE,this.onClose,this),n.init(this.webSocketClient)},this.onClose=function(t){alert("与服务器断开链接")},this.logoutChatServer=function(){null!==this.webSocketClient&&void 0!==this.webSocketClient&&(this.webSocketClient.close(),this.webSocketClient.removeEventListeners(),this.webSocketClient=null)},this.onConnected=function(t){n.loginChat(this.token)},this.listNotificationInterests=[i.LOGIN_CHAT_SERVER_SUCCESS,i.CHAT_USER_ONLINE,i.CHAT_USER_OFFLINE,i.CHAT_USER_MESSAGE,i.CHAT_GROUP_MESSAGE,i.CHAT_KICK,i.AGAIN_CONNECT,i.GET_CHAT_LIST,i.CHAT_TO_USER_MESSAGE],this.handleNotification=function(t){switch(t.name){case i.LOGIN_CHAT_SERVER_SUCCESS:this.LoginChatServerSuccess(t.body);break;case i.CHAT_USER_ONLINE:this.userOnline(t.body);break;case i.CHAT_USER_OFFLINE:this.userOffline(t.body);break;case i.CHAT_USER_MESSAGE:this.onUserMessage(t.body);break;case i.CHAT_GROUP_MESSAGE:this.onGroupMessage(t.body);break;case i.CHAT_KICK:alert("你即将被踢下线");break;case i.AGAIN_CONNECT:n.loginChat(this.token);break;case i.GET_CHAT_LIST:this.getChatListSuccess(t.body);break;case i.CHAT_TO_USER_MESSAGE:this.onToUserMessage(t.body)}},this.onReturnChat=function(t){this.nowModule=1,$(t.target).parents(".windowR_P.left2_P").hide().prev().show(),$(".talkCon_P").mCustomScrollbar("scrollTo","bottom")},this.userOnline=function(t){var s=this.userMap[t.chatUser.userId];if(null!==s&&void 0!==s){s.user=t.chatUser,s.onLine(),this.onlineNum++,$("#currentOnline").text(this.onlineNum);for(var i,n=$("#talkUserList")[0].childNodes,a=0;a<n.length;a++){var h=n[a];if(null!==h.id&&void 0!==h.id){i=h;break}}null!==i&&void 0!==i&&i.id!==s.user.userId&&$("#"+i.id).before($("#"+s.user.userId))}else(s=new o).init(t.chatUser),this.userMap[t.chatUser.userId]=s,$("#talkUserList").prepend(s.view),s.addOptListener(),s.addEventListener(e.OPEN_CHAT_OBJ,this.openChatObjHandle,this),this.onlineNum++,this.userNum++,$("#currentOnline").text(this.onlineNum),$("#allUser").text(this.userNum)},this.userOffline=function(t){var e=this.userMap[t.userId];if(null!==e&&void 0!==e){e.user.isOnline=!1,e.offLine(),this.onlineNum--,$("#currentOnline").text(this.onlineNum);for(var s,i=$("#talkUserList")[0].childNodes,n=i.length-1;n>=0;n--){var a=i[n];if(null!==a.id&&void 0!==a.id){s=a;break}}null!==s&&void 0!==s&&s.id!==e.user.userId&&$("#"+s.id).after($("#"+e.user.userId))}},this.LoginChatServerSuccess=function(t){this.own=t.chatUser;var s;if(null!==t.chatGroupList&&void 0!==t.chatGroupList)for(h=0;h<t.chatGroupList.length;h++){var i=t.chatGroupList[h],n=new a;n.init(i),this.groupMap[i.chatGroupId]=n,$("#talkList").prepend(n.view),n.addOptListener(),n.addEventListener(e.OPEN_CHAT_OBJ,this.openChatObjHandle,this),0===h&&(s=n)}if(null!==t.chatUserList&&void 0!==t.chatUserList){for(var h=0;h<t.chatUserList.length;h++){var r=t.chatUserList[h],c=new o;c.init(r),this.userMap[r.userId]=c,r.isOnline?$("#talkUserList").prepend(c.view):$("#talkUserList").append(c.view),c.addOptListener(),c.addEventListener(e.OPEN_CHAT_OBJ,this.openChatObjHandle,this),r.isOnline&&this.onlineNum++}$("#currentOnline").text(this.onlineNum),this.userNum=t.chatUserList.length,$("#allUser").text(this.userNum)}this.nowToObj=s,this.nowToObj.view.addClass("on_P"),$("#toTypeName").text(this.nowToObj.group.chatGroupName),$("#toTypeName2").text(this.nowToObj.group.chatGroupName)},this.openChatObjHandle=function(t){t.mTarget!==this.nowToObj&&(this.nowToObj=t.mTarget,$("#chatList #mCSB_2_container")[0].innerHTML="",null!==t.mTarget.user&&void 0!==t.mTarget.user?($("#toTypeName").text(this.nowToObj.user.userRealName),this.openChat(t.mTarget.chatList),$("#toTypeName2").text(this.nowToObj.user.userRealName)):($("#toTypeName").text(this.nowToObj.group.chatGroupName),this.openChat(t.mTarget.chatList),$("#toTypeName2").text(this.nowToObj.group.chatGroupName)),t.mTarget.view.removeClass("online_P"),2===this.nowModule&&this.getHistoryChatList(this.maxPage))},this.openChat=function(t){for(var e=0;e<t.length;e++){var s,i=t[e];s=i.userId===this.own.userId?this.createOwnChat(i):this.createOtherUserChat(i),$("#chatList #mCSB_2_container").append(s)}$(".talkCon_P").mCustomScrollbar("scrollTo","bottom")},this.createOtherUserChat=function(t){var e=document.createElement("div"),s=this.userMap[t.userId];e.className="otherAsk_P";var i;return i=null===s.user.userImg||void 0===s.user.userImg?"js/anychat/images/default.png":s.user.userImg,e.innerHTML='<a href="javascript:;" class="perPic_P"><img src="'+i+'" alt=""/></a><dl><dt>'+s.user.userRealName+"</dt><dd><span>"+t.chatContent+'</span></dd></dl><div class="clear"></div>',$(e)},this.createOwnChat=function(t){var e=document.createElement("div");e.className="myAsk_P";var s;return s=null===this.own.userImg||void 0===this.own.userImg?"js/anychat/images/default.png":this.own.userImg,e.innerHTML='<a href="javascript:;" class="perPic_P"><img src="'+s+'" alt=""/></a><dl><dd><span>'+t.chatContent+'</span></dd></dl><div class="clear"></div>',$(e)},this.onUserMessage=function(t){var e=!0;null!==this.nowToObj.user&&void 0!==this.nowToObj.user&&this.nowToObj.user.userId===t.userId&&(this.openChat(t.message),e=!1),e&&this.userMap[t.userId].view.addClass("online_P"),this.userMap[t.userId].chatList=this.userMap[t.userId].chatList.concat(t.message)},this.onToUserMessage=function(t){null!==this.nowToObj.user&&void 0!==this.nowToObj.user&&this.nowToObj.user.userId===t.toUserId&&this.openChat([t.message]),this.userMap[t.toUserId].chatList=this.userMap[t.toUserId].chatList.concat([t.message])},this.onGroupMessage=function(t){var e=!0;null!==this.nowToObj.group&&void 0!==this.nowToObj.group&&this.nowToObj.group.chatGroupId===t.chatGroupId&&(this.openChat(t.message),e=!1),e&&this.groupMap[t.chatGroupId].view.addClass("online_P"),this.groupMap[t.chatGroupId].chatList=this.groupMap[t.chatGroupId].chatList.concat(t.message)},this.onSendChat=function(t){var e=$("#sendChatContent").val();if(null!==e&&""!==e&&void 0!==e){var s,i;null!==this.nowToObj.user&&void 0!==this.nowToObj.user?(s=1,i=this.nowToObj.user.userId):(s=2,i=this.nowToObj.group.chatGroupId),n.sendMessage(e,s,i)}},this.onClickHistory=function(){$(".windowR_P.left2_P").show().prev().hide(),this.getHistoryChatList(this.maxPage),this.nowModule=2},this.setNowTime=function(){var t,e=new Date,s=e.getFullYear(),i=e.getMonth()+1;t=i<10?"0"+i:i;var n;n=(e=e.getDate())<10?"0"+e:e,$("#historyTime").text(s+"-"+t+"-"+n)},this.createHistoryChat=function(t){var e,s=document.createElement("dl");return e=t.userId===this.own.userId?this.own:this.userMap[t.userId].user,s.innerHTML='<dt class="org_P">'+e.userRealName+" "+t.chatCreateTime+"</dt><dd>"+t.chatContent+"</dd>",$(s)},this.getChatListSuccess=function(t){if(this.currentPage=t.currentPage,this.totalPage=t.totalPage,$("#firstPage").removeClass("disabled_P"),$("#prePage").removeClass("disabled_P"),$("#nextPage").removeClass("disabled_P"),$("#lastPage").removeClass("disabled_P"),this.currentPage!==this.totalPage&&null!==this.totalPage&&void 0!==this.totalPage||($("#nextPage").addClass("disabled_P"),$("#lastPage").addClass("disabled_P")),1===this.currentPage&&($("#firstPage").addClass("disabled_P"),$("#prePage").addClass("disabled_P")),$("#histortChat").text(""),null!==t.message&&void 0!==t.message&&0!==t.message.length)for(var e=0;e<t.message.length;e++){var s=t.message[e],i=this.createHistoryChat(s);if($("#histortChat").append(i),0===e){var n=s.chatCreateTime.split(" ");$("#historyTime").text(n[0])}}else this.setNowTime()},this.onFirstPage=function(){this.getHistoryChatList(1)},this.onPrePage=function(){this.getHistoryChatList(this.currentPage-1)},this.onNextPage=function(){this.getHistoryChatList(this.currentPage+1)},this.onLastPage=function(){this.getHistoryChatList(this.maxPage)},this.getHistoryChatList=function(t,e){var s,i;null!==this.nowToObj.user&&void 0!==this.nowToObj.user?(s=1,i=this.nowToObj.user.userId):(s=2,i=this.nowToObj.group.chatGroupId),n.getMessage(s,i,e,t,this.pageSize)},h.apply(this)}}(window);